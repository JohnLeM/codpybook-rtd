

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>6.4.5 Conditioning on discrete distributions of celebA dataset &mdash; CodPy Book 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=8d563738"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6.5 Unsupervised learning: Clustering - Stock Clustering" href="ch6_stockClustering.html" />
    <link rel="prev" title="6.4.1 Generating complex distributions from celebA dataset" href="ch6_9_CelebA.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            CodPy Book
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Chapter 2:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../auto_ch2/index.html">Chapter 2: Basic notions on reproducing kernels</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch2/ch2_2.html">2.2 Reproducing kernels and transformation maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch2/ch2_ex1D.html">2.3 1D Periodic Function Extrapolation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch2/ch2_5.html">2.3.2 Applying maps to kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch2/ch2_ex2D.html">2.4 2D Periodic Function Extrapolation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch2/ch2_discrepancy_functional.html">2.6.2 A study of the discrepancy functional</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Chapter 3:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../auto_ch3/index.html">Chapter 3: Discrete operators based on reproducing kernels</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch3/ch3_3_2.html">3.3.2 Partition of unity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch3/ch3_4_1.html">3.4.1 Gradient Operator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch3/ch3_4_2.html">3.4.2 Divergence Operator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch3/ch3_4_3.html">3.4.3  Inverse Laplace operator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch3/ch3_4_4.html">3.4.4 Integral operator - inverse gradient operator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch3/ch3_4_5.html">3.4.5  Integral operator - inverse divergence operator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch3/ch3_4_6.html">3.4.6 Leray-orthogonal operator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch3/ch3_4_7.html">3.4.7 Leray operator and Helmholtz-Hodge decomposition</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Chapter 4:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../auto_ch4/index.html">Chapter 4: Clustering strategies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch4/ch4_2.html">4.2 Clustering</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Chapter 5:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../auto_ch5/index.html">Chapter 5: Optimal transport and statistical kernel methods</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch5/ch5_2.html">5.2 Optimal Transport: LSAP (Linear Sum Assignment Problem)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch5/ch5_33.html">5.3.3 Kernel Conditional Density</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch5/ch5_34.html">5.3.4 Kernel Conditional Expectation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch5/ch5_6_a.html">5.6.a Application of OT in Disitribution Sampling : 1D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch5/ch5_6_b.html">5.6.b Application of OT in Disitribution Sampling : 2D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch5/ch5_6_c.html">5.6.c Application of OT in Disitribution Sampling : High-Dimensional case</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch5/ch5_6_d.html">5.6.d Exploration Data Analysis of the Latent Space: Spherical Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch5/ch5_7.html">5.7. Conditional Sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch5/ch5_8.html">5.8. Conditional Sampling</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Chapter 6:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Chapter 6: Applications to machine learning : supervised, unsupervised and generative methods</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ch6_housing.html">6.1 Supervised learning: reproducibility illustration with housing prices</a></li>
<li class="toctree-l2"><a class="reference internal" href="ch6_mnist.html">6.2 Supervised learning: benchmarks of methods with MNIST</a></li>
<li class="toctree-l2"><a class="reference internal" href="ch6_Clustering.html">6.3 Unsupervised learning: Clustering - MNIST</a></li>
<li class="toctree-l2"><a class="reference internal" href="ch6_ClustMNIST.html">6.3 Unsupervised learning: Clustering - MNIST</a></li>
<li class="toctree-l2"><a class="reference internal" href="ch6_CreditCardFraud.html">6.4 Unsupervised learning: Clustering - Fraud detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="ch6_9_CelebA_reconstruction.html">6.4.1 Generating complex distributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="ch6_9_CelebA.html">6.4.1 Generating complex distributions from celebA dataset</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">6.4.5 Conditioning on discrete distributions of celebA dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="ch6_stockClustering.html">6.5 Unsupervised learning: Clustering - Stock Clustering</a></li>
<li class="toctree-l2"><a class="reference internal" href="ch6_iris.html">6.7. Conditional Sampling</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Chapter 7:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../auto_ch7/index.html">Chapter 7: Application to partial differential equations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch7/ch7_invLaplace.html">7.01 Inverse Laplace Operator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch7/ch7_denoising.html">7.02 Denoising</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch7/ch7_heat_eq.html">7.03 Heat Equation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch7/ch7_heatLagrange.html">7.04 Lagrange Heat Equation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch7/ch7_convexHull.html">7.05 Convex Hull Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch7/ch7_AAD.html">7.06 Automatic Differentiation</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Chapter 8:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../kqlearning.html">KQLearning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../auto_ch8/index.html">Chapter 8: Reinforcement learning.</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch8/ch8_example.html">8.1 Using KAgents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch8/ch8_cartpole.html">8.2 Experiments - Cartpole</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch8/ch8_lunarlander.html">8.3 Experiments - LunarLander</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Chapter 9:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../auto_ch9/index.html">Chapter 9: Mathematical Finance.</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch9/ch9_get_market_data.html">9.01 Free time series modeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch9/ch9_random_walk_log_normal.html">9.02 Random walks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch9/ch9_arma.html">9.03 ARMA(p,1) model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch9/ch9_garch.html">9.04 GARCH(1,1) model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch9/ch9_lagrange.html">9.05 Lagrange interpolation model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch9/ch9_additive.html">9.06 Additive noise map</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch9/ch9_conditionning.html">9.07 Conditionning model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch9/ch9_stoch_vol.html">9.08 Stochastic volatility model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch9/ch9_HestonCompare.html">9.10 Heston Process - Path comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch9/ch9_isocontours.html">9.11 Heston Process - Intraday interpolation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch9/ch9_priceExtrapolation.html">9.12 Price extrapolation using KRR and Taylor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch9/ch9_greeks.html">9.13 Greeks output after correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch9/ch9_rst.html">9.13 Reverse Stress Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_ch9/ch9_HestonRepro.html">9.9 Heston Process - Reproducibility</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../utils/ch9/ch9_utils.html">Chapter 9 utility functions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CodPy Book</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Chapter 6: Applications to machine learning : supervised, unsupervised and generative methods</a></li>
      <li class="breadcrumb-item active">6.4.5 Conditioning on discrete distributions of celebA dataset</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/auto_ch6/ch6_9_transfert.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-ch6-ch6-9-transfert-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="conditioning-on-discrete-distributions-of-celeba-dataset">
<span id="sphx-glr-auto-ch6-ch6-9-transfert-py"></span><h1>6.4.5 Conditioning on discrete distributions of celebA dataset<a class="headerlink" href="#conditioning-on-discrete-distributions-of-celeba-dataset" title="Link to this heading"></a></h1>
<p>We reproduce the Figure 6.15 from the book.
We train a model on the CelebA dataset, conditionned on the features.
We then select 10 images with hats and eyeglasses, and slowly generate new images
By varying the strength of those features, resulting in a verion of “no hats and eyeglasses”</p>
<dl class="simple">
<dt>Necessary Imports</dt><dd></dd>
</dl>
<p>Everything is already made in the previous file, so we just import it here.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ch6_9_CelebA</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>


<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;input_shape&#39;</span><span class="p">:[</span><span class="mi">218</span><span class="p">,</span><span class="mi">178</span><span class="p">],</span>
    <span class="s1">&#39;rescale_shape&#39;</span><span class="p">:[</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span>
    <span class="s1">&#39;Nx&#39;</span><span class="p">:</span><span class="mi">1000</span><span class="p">,</span>  <span class="c1"># Number of images to use for training</span>
    <span class="s1">&#39;Nz&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="c1"># Numer of images to generate</span>
    <span class="s1">&#39;seed&#39;</span><span class="p">:</span><span class="mi">40</span><span class="p">,</span>
    <span class="s2">&quot;main_folder&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span><span class="s1">&#39;celebA&#39;</span><span class="p">),</span>
<span class="p">}</span>
<span class="k">def</span><span class="w"> </span><span class="nf">style_transferts</span><span class="p">(</span>
      <span class="n">selected_features</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Young&#39;</span><span class="p">,</span><span class="s1">&#39;Attractive&#39;</span><span class="p">],</span>
      <span class="n">drop_features</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Male&#39;</span><span class="p">,</span><span class="s1">&#39;Heavy_Makeup&#39;</span><span class="p">],</span>
      <span class="n">conditionned_features</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Wearing_Hat&#39;</span><span class="p">,</span><span class="s1">&#39;Eyeglasses&#39;</span><span class="p">],</span>
      <span class="n">other_features</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Blond_Hair&#39;</span><span class="p">,</span><span class="s1">&#39;Smiling&#39;</span><span class="p">],</span>
      <span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
      <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>

    <span class="n">n_images</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;Nx&#39;</span><span class="p">]</span>
    <span class="n">Nz</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;Nz&#39;</span><span class="p">]</span>
    <span class="c1"># Collect all images</span>
    <span class="n">celeba</span> <span class="o">=</span> <span class="n">CelebA_data_generator</span><span class="p">(</span><span class="n">selected_features</span><span class="o">=</span><span class="n">selected_features</span><span class="p">,</span><span class="n">drop_features</span><span class="o">=</span><span class="n">drop_features</span><span class="p">)</span>
    <span class="n">x_target_all</span><span class="p">,</span> <span class="n">img_paths_all</span><span class="p">,</span> <span class="n">features_all</span> <span class="o">=</span> <span class="n">celeba</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">conditionned_features</span><span class="o">=</span><span class="n">conditionned_features</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">features_all</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;path&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Remove the path column</span>
    <span class="c1"># pics = tiles(x_target_all.loc[[&#39;005350.jpg&#39;]].values,pic_shape=kwargs[&#39;input_shape&#39;],tile_shape=[1,1])</span>
    <span class="c1"># plt.imshow(pics)</span>

    <span class="c1"># We get those with hats and/or eyeglasses</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">other_features</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">features_all</span> <span class="o">=</span> <span class="n">features_all</span><span class="p">[</span><span class="n">conditionned_features</span><span class="o">+</span><span class="n">other_features</span><span class="p">]</span>

    <span class="n">all_conditionned_and</span> <span class="o">=</span> <span class="n">features_all</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">conditionned_features</span><span class="p">:</span>
        <span class="n">all_conditionned_and</span> <span class="o">=</span> <span class="n">all_conditionned_and</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">all_conditionned_and</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">==+</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># idx_and = all_conditionned_and.index[:Nz]</span>
    <span class="n">idx_and</span> <span class="o">=</span> <span class="n">all_conditionned_and</span><span class="o">.</span><span class="n">index</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;selected ids: </span><span class="si">{</span><span class="n">idx_and</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># We get again new images with none of those, whatever remains from the required initial number of images</span>
    <span class="n">features_and</span> <span class="o">=</span> <span class="n">features_all</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx_and</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># all_features = features.values[:,:-1] # Remove the last column which is the image path</span>

    <span class="n">all_features</span> <span class="o">=</span> <span class="n">features_all</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">x_target_all</span> <span class="o">=</span> <span class="n">x_target_all</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">idx_and</span> <span class="o">=</span> <span class="n">all_features</span><span class="p">[</span><span class="n">all_features</span><span class="p">[</span><span class="s1">&#39;image_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">idx_and</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span>
    <span class="n">x_target_all</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;image_id&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Remove the image_id column</span>
    <span class="n">all_features</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;image_id&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Remove the image_id column</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset Ready&quot;</span><span class="p">)</span>

    <span class="c1"># We condition y | x</span>
    <span class="c1"># y are our images</span>
    <span class="c1"># x are our features</span>
    <span class="n">conditionner</span> <span class="o">=</span> <span class="n">codpy</span><span class="o">.</span><span class="n">conditioning</span><span class="o">.</span><span class="n">ConditionerKernel</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">all_features</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">x_target_all</span><span class="p">,</span>
        <span class="n">latent_dim_y</span><span class="o">=</span><span class="n">dimension</span>
    <span class="p">)</span>

    <span class="n">conditionner</span><span class="o">.</span><span class="n">set_maps</span><span class="p">(</span><span class="nb">iter</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">permut_idx_and</span> <span class="o">=</span> <span class="n">map_invertion</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">conditionner</span><span class="o">.</span><span class="n">sampler_xy</span><span class="o">.</span><span class="n">permutation</span><span class="p">))[</span><span class="n">idx_and</span><span class="p">]</span>
    <span class="n">latent_values_y</span> <span class="o">=</span> <span class="n">conditionner</span><span class="o">.</span><span class="n">latent_y</span>
    <span class="n">latent_values_y_and</span> <span class="o">=</span> <span class="n">latent_values_y</span><span class="p">[</span><span class="n">permut_idx_and</span><span class="p">]</span>
    <span class="n">latent_values_x</span> <span class="o">=</span> <span class="n">conditionner</span><span class="o">.</span><span class="n">latent_x</span>
    <span class="n">latent_values_x_and</span> <span class="o">=</span> <span class="n">latent_values_x</span><span class="p">[</span><span class="n">permut_idx_and</span><span class="p">]</span>

    <span class="c1">#compute latent values of selected pictures</span>
    <span class="n">latent_images_and</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">latent_values_x_and</span><span class="p">,</span><span class="n">latent_values_y_and</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># -1 because we remove the img path</span>
    <span class="c1">#check the reconstruction. comment after checking</span>
    <span class="c1"># pics = tiles(conditionner.get_y()[idx_and],pic_shape=kwargs[&#39;input_shape&#39;],tile_shape=[1,len(idx_and)])</span>
    <span class="c1"># plt.imshow(pics)</span>
    <span class="c1"># plt.show()</span>
    <span class="c1"># reconstructed_images = conditionner.sampler_xy(latent_images_and)[:,all_features.shape[1]:]</span>
    <span class="c1"># pics = tiles(reconstructed_images,pic_shape=kwargs[&#39;input_shape&#39;],tile_shape=[1,len(idx_and)])</span>
    <span class="c1"># plt.imshow(pics)</span>
    <span class="c1"># plt.show()</span>


    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;conditionner ready&quot;</span><span class="p">)</span>
    <span class="n">results</span><span class="o">=</span><span class="kc">None</span>


    <span class="n">latent_images_and</span> <span class="o">=</span> <span class="n">latent_images_and</span><span class="p">[:</span><span class="n">Nz</span><span class="p">]</span>
    <span class="n">cond_feat</span> <span class="o">=</span> <span class="n">latent_images_and</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># feature_strength_list = [1, 0.5, 0.0, -0.5, -1]</span>
    <span class="n">feature_strength_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">feature_strength</span> <span class="ow">in</span> <span class="n">feature_strength_list</span><span class="p">:</span>
        <span class="c1"># Update the and features on the conditionned features and extract values</span>
        <span class="n">cond_feat</span><span class="p">[:,:</span><span class="nb">len</span><span class="p">(</span><span class="n">conditionned_features</span><span class="p">)]</span> <span class="o">=</span> <span class="n">latent_images_and</span><span class="p">[:,:</span><span class="nb">len</span><span class="p">(</span><span class="n">conditionned_features</span><span class="p">)]</span><span class="o">*</span><span class="n">feature_strength</span>

        <span class="c1"># Sampling new images</span>
        <span class="n">sampled_images</span> <span class="o">=</span> <span class="n">conditionner</span><span class="o">.</span><span class="n">sampler_xy</span><span class="p">(</span><span class="n">cond_feat</span><span class="p">)[:,</span><span class="n">all_features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:]</span>
        <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">sampled_images</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">results</span><span class="p">,</span> <span class="n">sampled_images</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># print(f&quot;Added {feature_strength} feature results&quot;)</span>
    <span class="n">pics</span> <span class="o">=</span> <span class="n">tiles</span><span class="p">(</span><span class="n">results</span><span class="p">,</span><span class="n">pic_shape</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;input_shape&#39;</span><span class="p">],</span><span class="n">tile_shape</span><span class="o">=</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">feature_strength_list</span><span class="p">),</span><span class="n">results</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_strength_list</span><span class="p">)])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pics</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">pic_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_images</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;D_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dimension</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">proj_path</span><span class="p">,</span><span class="s2">&quot;pic_transfert_N&quot;</span><span class="o">+</span><span class="n">pic_name</span><span class="p">),</span><span class="n">pics</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saved&quot;</span><span class="p">,</span><span class="n">pic_name</span><span class="p">)</span>
    <span class="k">pass</span>

<span class="n">style_transferts</span><span class="p">(</span>
      <span class="n">selected_features</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Young&#39;</span><span class="p">,</span><span class="s1">&#39;Attractive&#39;</span><span class="p">],</span>
      <span class="n">drop_features</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Male&#39;</span><span class="p">,</span><span class="s1">&#39;Heavy_Makeup&#39;</span><span class="p">],</span>
      <span class="n">conditionned_features</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Eyeglasses&#39;</span><span class="p">,</span><span class="s1">&#39;Wearing_Hat&#39;</span><span class="p">],</span>
      <span class="n">other_features</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Blond_Hair&#39;</span><span class="p">,</span><span class="s1">&#39;Smiling&#39;</span><span class="p">],</span>
      <span class="n">dimension</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
      <span class="o">**</span><span class="n">config</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_ch6_9_transfert_001.png" srcset="../_images/sphx_glr_ch6_9_transfert_001.png" alt="ch6 9 transfert" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>selected ids: Index([&#39;195295.jpg&#39;, &#39;032877.jpg&#39;, &#39;006323.jpg&#39;, &#39;124151.jpg&#39;, &#39;022875.jpg&#39;,
       &#39;157535.jpg&#39;, &#39;053936.jpg&#39;, &#39;045012.jpg&#39;, &#39;172059.jpg&#39;, &#39;137214.jpg&#39;,
       &#39;014630.jpg&#39;, &#39;190524.jpg&#39;, &#39;034486.jpg&#39;],
      dtype=&#39;object&#39;, name=&#39;image_id&#39;)
Dataset Ready
conditionner ready
Saved 1000D_4.png
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (2 minutes 30.995 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-ch6-ch6-9-transfert-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/58ca54dfa40f7eecdd76968c53e7ad51/ch6_9_transfert.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">ch6_9_transfert.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/e26eb954e47e840e6ea6c0f7419606ad/ch6_9_transfert.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">ch6_9_transfert.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../_downloads/e0e118c0bb91414b2fdc9530e00c9a8c/ch6_9_transfert.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">ch6_9_transfert.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ch6_9_CelebA.html" class="btn btn-neutral float-left" title="6.4.1 Generating complex distributions from celebA dataset" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ch6_stockClustering.html" class="btn btn-neutral float-right" title="6.5 Unsupervised learning: Clustering - Stock Clustering" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Philippe G. LeFloch , Jean-Marc Mercier, and Shohruh Miryusupov.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>